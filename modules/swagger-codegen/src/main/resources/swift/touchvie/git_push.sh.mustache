#Swagger repo variables
git_user_id="touchvie"
git_repo_id="swift-swagger-pod"
git_repo_url="https://github.com/${git_user_id}/${git_repo_id}.git"
git_repo_folder="/tmp/swagger-repo/"
release_note="another release test"

#Path variables
path_to_swagger_files="/iOSSwaggerClient/Classes/Swaggers/*"
path_to_swagger="/Users/jonathan.castro/swagger-codegen/samples/client/touchvie/swift/default"

if [ "$1" != "" ] && [ "$2" != "" ]; then
	
	#Clone the swift-swagger-repo
	git clone $git_repo_url $git_repo_folder

	#move directory to own repo
	cd ${git_repo_folder}
	ls

	#Checkout to the branch
	case $1 in
		master)
			echo master selected
			git checkout -q master

		;;

		preproduction)
			echo preproduction selected
			git checkout -q preproduction
		;;

		production)
			echo production selected
			git checkout -q production
		;;
	esac

	#Copy swagger client generated files to own repo directory
	cp -Rf ${path_to_swagger}${path_to_swagger_files} ${git_repo_folder}

	#configure the git
	git config --global user.name "JonathanCastroMiguel"
	git config --global user.email jonathan.castro.miguel@gmail.com

	#Commit changes
	git add -A

	#print status
	git status

	git commit -m "Updated to version "${2}

	#Create tag with the version
	git tag -a ${2} -m "Version "${2}

	#copy the podSpecs generated by Swagger to own repo directory
	cp -Rf "${path_to_swagger}/iOSSwaggerClient.podspec" ${git_repo_folder}

	#edit the podSpecs with the version
	cat iOSSwaggerClient.podspec | sed -e "s/\(.*\)s.version = '.*'/\1s.version = '$2'/g" > iOSSwaggerClient.new
	mv iOSSwaggerClient.new iOSSwaggerClient.podspec

	#commit the podSpec
	git add -A

	#print status
	git status

	git commit -m "Added podSpec of version "${2}

	#push in the concrete branch the two commits
	git push origin $1

	#move directory to 
	#cd ${path_to_swagger}

	#push the podSpecs in Pod repository
	#test pod

else
	echo ERROR: You must to call this script with arguments: 1: environment master,preproduction,production and 2: version

	echo ${path_to_swagger}${path_to_swagger_files}
	echo "Version "${2}
	echo ${2}
	echo "${path_to_swagger}/iOSSwaggerClient.podspec"
fi